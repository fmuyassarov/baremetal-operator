<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="generator" content="Asciidoctor 2.0.10"/>
<title>Baremetal Operator</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"/>
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed;word-wrap:break-word}
:not(pre)>code.nobreak{word-wrap:normal}
:not(pre)>code.nowrap{white-space:nowrap}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:100%;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
table.tableblock{max-width:100%;border-collapse:separate}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
td.tableblock>.content>:last-child.sidebarblock{margin-bottom:0}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>thead>tr>.tableblock,table.grid-all>tbody>tr>.tableblock{border-width:0 1px 1px 0}
table.grid-all>tfoot>tr>.tableblock{border-width:1px 1px 0 0}
table.grid-cols>*>tr>.tableblock{border-width:0 1px 0 0}
table.grid-rows>thead>tr>.tableblock,table.grid-rows>tbody>tr>.tableblock{border-width:0 0 1px}
table.grid-rows>tfoot>tr>.tableblock{border-width:1px 0 0}
table.grid-all>*>tr>.tableblock:last-child,table.grid-cols>*>tr>.tableblock:last-child{border-right-width:0}
table.grid-all>tbody>tr:last-child>.tableblock,table.grid-all>thead:last-child>tr>.tableblock,table.grid-rows>tbody>tr:last-child>.tableblock,table.grid-rows>thead:last-child>tr>.tableblock{border-bottom-width:0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot,table.frame-ends{border-width:1px 0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Baremetal Operator</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_api_and_resource_definitions">1. API and Resource Definitions</a>
<ul class="sectlevel2">
<li><a href="#_baremetalhost">1.1. BareMetalHost</a></li>
<li><a href="#_triggering_provisioning">1.2. Triggering Provisioning</a></li>
<li><a href="#_unmanaged_hosts">1.3. Unmanaged Hosts</a></li>
<li><a href="#_pausing_reconciliation">1.4. Pausing reconciliation</a></li>
</ul>
</li>
<li><a href="#_setup_development_environment">2. Setup Development Environment</a>
<ul class="sectlevel2">
<li><a href="#_with_minikube">2.1. With minikube</a></li>
<li><a href="#_running_without_ironic">2.2. Running without Ironic</a></li>
<li><a href="#_running_a_local_instance_of_ironic">2.3. Running a local instance of Ironic</a></li>
<li><a href="#_using_tilt_for_development">2.4. Using Tilt for development</a></li>
<li><a href="#_using_libvirt_vms_with_ironic">2.5. Using libvirt VMs with Ironic</a></li>
<li><a href="#_using_bare_metal_hosts">2.6. Using Bare Metal Hosts</a></li>
</ul>
</li>
<li><a href="#_running_the_tests">3. Running the tests</a>
<ul class="sectlevel2">
<li><a href="#_setup">3.1. Setup</a></li>
<li><a href="#_using_the_hack_scripts">3.2. Using the Hack scripts</a></li>
<li><a href="#_getting_the_latest_tooling">3.3. Getting the latest tooling</a></li>
</ul>
</li>
<li><a href="#_running_baremetal_operator_with_or_without_ironic">4. Running Baremetal Operator with or without Ironic</a>
<ul class="sectlevel2">
<li><a href="#_current_structure_of_baremetal_operator_config_directory">4.1. Current structure of baremetal-operator config directory</a></li>
<li><a href="#_current_structure_of_ironic_deployment_directory">4.2. Current structure of ironic-deployment directory</a></li>
<li><a href="#_deployment_commands">4.3. Deployment commands</a></li>
<li><a href="#_useful_tips">4.4. Useful tips</a></li>
</ul>
</li>
<li><a href="#_authenticating_to_ironic">5. Authenticating to Ironic</a>
<ul class="sectlevel2">
<li><a href="#_configuration">5.1. Configuration</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_api_and_resource_definitions">1. API and Resource Definitions</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_baremetalhost">1.1. BareMetalHost</h3>
<div class="paragraph">
<p>MetalÂ³ introduces the concept of BareMetalHost resource, which
defines a physical host and its properties. The BareMetalHost embeds
two well differentiated sections, the bare metal host specification and
its current status.</p>
</div>
<div class="sect3">
<h4 id="_baremetalhost_spec">1.1.1. BareMetalHost spec</h4>
<div class="paragraph">
<p>The <em>BareMetalHost&#8217;s</em> <em>spec</em> defines the desire state of the host. It
contains mainly, but not only, provisioning details.</p>
</div>
<div class="sect4">
<h5 id="_bmc">bmc</h5>
<div class="paragraph">
<p>The <code>bmc</code> fields contain the connection information for the BMC
(Baseboard Management Controller) on the host.</p>
</div>
<div class="paragraph">
<p>The sub-fields are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>address</em>&#8201;&#8212;&#8201;The URL for communicating with the BMC controller, based
on the provider being used. See below for more details.</p>
</li>
<li>
<p><em>credentialsName</em>&#8201;&#8212;&#8201;A reference to a <em>secret</em> containing the username
and password for the BMC.</p>
</li>
<li>
<p><em>disableCertificateVerification</em>&#8201;&#8212;&#8201;A boolean to skip certificate
validation when true.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>BMC URLs vary based on the type of BMC and the protocol used to
communicate with them.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IPMI</p>
<div class="ulist">
<ul>
<li>
<p><code>ipmi://&lt;host&gt;:&lt;port&gt;</code>, an unadorned <code>&lt;host&gt;:&lt;port&gt;</code> is also accepted
and the port is optional, if using the default one (623).</p>
</li>
</ul>
</div>
</li>
<li>
<p>Dell iDRAC</p>
<div class="ulist">
<ul>
<li>
<p><code>idrac://</code> (or <code>idrac+http://</code> to disable TLS).</p>
</li>
<li>
<p><code>idrac-virtualmedia://</code> to use virtual media instead of PXE for
attaching the provisioning image to the host.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Fujitsu iRMC</p>
<div class="ulist">
<ul>
<li>
<p><code>irmc://&lt;host&gt;:&lt;port&gt;</code>, where <code>&lt;port&gt;</code> is optional if using the
default.</p>
</li>
</ul>
</div>
</li>
<li>
<p>HUAWEI ibmc</p>
<div class="ulist">
<ul>
<li>
<p><code>ibmc://&lt;host&gt;:&lt;port&gt;</code> (or <code>ibmc+http://&lt;host&gt;:&lt;port&gt;</code> to disable
TLS)</p>
</li>
</ul>
</div>
</li>
<li>
<p>HPE iLO 4</p>
<div class="ulist">
<ul>
<li>
<p><code>ilo4://&lt;host&gt;:&lt;port&gt;</code> for iLO 4 based systems and the port is
optional, if using the default one (443).</p>
</li>
</ul>
</div>
</li>
<li>
<p>HPE iLO 5</p>
<div class="ulist">
<ul>
<li>
<p><code>ilo5://&lt;host&gt;:&lt;port&gt;</code> for iLO 5 based systems and the port is
optional, if using the default one (443).</p>
</li>
</ul>
</div>
</li>
<li>
<p>iLO 5 Redfish</p>
<div class="ulist">
<ul>
<li>
<p><code>ilo5-redfish://</code> (or <code>ilo5-redfish+http://</code> to disable TLS), the
hostname or IP address, and the path to the system ID are required, for
example
<code>ilo5-redfish://myhost.example/redfish/v1/Systems/MySystemExample</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>Redfish</p>
<div class="ulist">
<ul>
<li>
<p><code>redfish://</code> (or <code>redfish+http://</code> to disable TLS)</p>
</li>
<li>
<p><code>redfish-virtualmedia://</code> to use virtual media instead of PXE for
attaching the provisioning image to the host.</p>
</li>
<li>
<p>The hostname or IP address, and the path to the system ID are
required for all variants. For example
<code>redfish://myhost.example/redfish/v1/Systems/System.Embedded.1</code> or
<code>redfish://myhost.example/redfish/v1/Systems/1</code></p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_online">online</h5>
<div class="paragraph">
<p>A boolean indicating whether the host should be powered on (true) or off
(false). Changing this value will trigger a change in power state on the
physical host.</p>
</div>
</div>
<div class="sect4">
<h5 id="_consumerref">consumerRef</h5>
<div class="paragraph">
<p>A reference to another resource that is using the host, it could be
empty if the host is not being currently used. For example, a <em>Machine</em>
resource when the host is being used by the
<a href="https://github.com/kubernetes-sigs/cluster-api"><em>machine-api</em></a>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_externallyprovisioned">externallyProvisioned</h5>
<div class="paragraph">
<p>A boolean indicating whether the host provisioning and deprovisioning
are managed externally. When set, the host&#8217;s power status and hardware
inventory will be monitored but no provisioning or deprovisioning
operations are performed on the host.</p>
</div>
</div>
<div class="sect4">
<h5 id="_image">image</h5>
<div class="paragraph">
<p>Holds details for the image to be deployed on a given host.</p>
</div>
<div class="paragraph">
<p>The sub-fields are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>url</em>&#8201;&#8212;&#8201;The URL of an image to deploy to the host.</p>
</li>
<li>
<p><em>checksum</em>&#8201;&#8212;&#8201;The actual checksum or a URL to a file containing the
checksum for the image at <em>image.url</em>.</p>
</li>
<li>
<p><em>checksumType</em>&#8201;&#8212;&#8201;Checksum algorithms can be specified. Currently only
<code>md5</code>, <code>sha256</code>, <code>sha512</code> are recognized. If nothing is specified <code>md5</code>
is assumed.</p>
</li>
<li>
<p><em>format</em>&#8201;&#8212;&#8201;This is the disk format of the image. It can be one of
<code>raw</code>, <code>qcow2</code>, <code>vdi</code>, <code>vmdk</code>, or be left unset. Setting it to raw
enables raw image streaming in Ironic agent for that image.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even though the image sub-fields are required by Ironic, when the host
provisioning is managed externally via <code>externallyProvisioned: true</code>,
and power control isn&#8217;t needed, the fields can be left empty.</p>
</div>
</div>
<div class="sect4">
<h5 id="_userdata">userData</h5>
<div class="paragraph">
<p>A reference to the Secret containing the cloudinit user data and its
namespace, so it can be attached to the host before it boots for
configuring different aspects of the OS (like networking, storage, &#8230;&#8203;).</p>
</div>
</div>
<div class="sect4">
<h5 id="_networkdata">networkData</h5>
<div class="paragraph">
<p>A reference to the Secret containing the network configuration data
(e.g. network_data.json) and its namespace, so it can be attached to the
host before it boots to set network up</p>
</div>
</div>
<div class="sect4">
<h5 id="_description">description</h5>
<div class="paragraph">
<p>A human-provided string to help identify the host.</p>
</div>
</div>
<div class="sect4">
<h5 id="_hardwareprofile">hardwareProfile</h5>
<div class="paragraph">
<p><strong>This field is deprecated. See rootDeviceHints instead.</strong></p>
</div>
<div class="paragraph">
<p>The name of the hardware profile to use. The following are the current
supported <code>hardwareProfile</code> settings and their corresponding root
devices.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>hardwareProfile</strong></th>
<th class="tableblock halign-left valign-top"><strong>Root Device</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unknown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/dev/sda</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>libvirt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/dev/vda</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dell</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HCTL: 0:0:0:0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dell-raid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HCTL: 0:2:0:0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openstack</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/dev/vdb</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>NOTE:</strong> These are subject to change.</p>
</div>
</div>
<div class="sect4">
<h5 id="_rootdevicehints">rootDeviceHints</h5>
<div class="paragraph">
<p>Guidance for how to choose the device to receive the image being
provisioned. The storage devices are examined in the order they are
discovered during inspection and the hint values are compared to the
inspected values. The first discovered device that matches is used.
Hints can be combined, and if multiple hints are provided then a device
must match all hints in order to be selected.</p>
</div>
<div class="paragraph">
<p>The sub-fields are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>deviceName</em>&#8201;&#8212;&#8201;A string containing a Linux device name like
<code>/dev/vda</code>. The hint must match the actual value exactly.</p>
</li>
<li>
<p><em>hctl</em>&#8201;&#8212;&#8201;A string containing a SCSI bus address like <code>0:0:0:0</code>. The
hint must match the actual value exactly.</p>
</li>
<li>
<p><em>model</em>&#8201;&#8212;&#8201;A string containing a vendor-specific device identifier.
The hint can be a substring of the actual value.</p>
</li>
<li>
<p><em>vendor</em>&#8201;&#8212;&#8201;A string containing the name of the vendor or manufacturer
of the device. The hint can be a substring of the actual value.</p>
</li>
<li>
<p><em>serialNumber</em>&#8201;&#8212;&#8201;A string contianing the device serial number. The
hint must match the actual value exactly.</p>
</li>
<li>
<p><em>minSizeGigabytes</em>&#8201;&#8212;&#8201;An integer representing the minimum size of the
device in Gigabytes.</p>
</li>
<li>
<p><em>wwn</em>&#8201;&#8212;&#8201;A string containing the unique storage identifier. The hint
must match the actual value exactly.</p>
</li>
<li>
<p><em>wwnWithExtension</em>&#8201;&#8212;&#8201;A string containing the unique storage
identifier with the vendor extension appended. The hint must match the
actual value exactly.</p>
</li>
<li>
<p><em>wwnVendorExtension</em>&#8201;&#8212;&#8201;A string containing the unique vendor storage
indentifier. The hint must match the actual value exactly.</p>
</li>
<li>
<p><em>rotational</em>&#8201;&#8212;&#8201;A boolean indicating whether the device should be a
rotating disk (<code>true</code>) or not (<code>false</code>).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_baremetalhost_status">1.1.2. BareMetalHost status</h4>
<div class="paragraph">
<p>Moving onto the next block, the <em>BareMetalHost&#8217;s</em> <em>status</em> which
represents the host&#8217;s current state. Including tested credentials,
current hardware details, etc.</p>
</div>
<div class="sect4">
<h5 id="_goodcredentials">goodCredentials</h5>
<div class="paragraph">
<p>A reference to the secret and its namespace holding the last set of BMC
credentials the system was able to validate as working.</p>
</div>
</div>
<div class="sect4">
<h5 id="_triedcredentials">triedCredentials</h5>
<div class="paragraph">
<p>A reference to the secret and its namespace holding the last set of BMC
credentials that were sent to the provisioning backend.</p>
</div>
</div>
<div class="sect4">
<h5 id="_lastupdated">lastUpdated</h5>
<div class="paragraph">
<p>The timestamp of the last time the status of the host was updated.</p>
</div>
</div>
<div class="sect4">
<h5 id="_operationalstatus">operationalStatus</h5>
<div class="paragraph">
<p>The status of the server. Value is one of the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>OK</em>&#8201;&#8212;&#8201;Indicates all the details for the host are known and working,
meaning the host is correctly configured and manageable.</p>
</li>
<li>
<p><em>discovered</em>&#8201;&#8212;&#8201;Implies some of the host&#8217;s details are either not
working correctly or missing. For example, the BMC address is known but
the login credentials are not.</p>
</li>
<li>
<p><em>error</em>&#8201;&#8212;&#8201;Indicates the system found some sort of irrecuperable
error. Refer to the <em>errorMessage</em> field in the status section for more
details.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_errormessage">errorMessage</h5>
<div class="paragraph">
<p>Details of the last error reported by the provisioning backend, if any.</p>
</div>
</div>
<div class="sect4">
<h5 id="_hardware">hardware</h5>
<div class="paragraph">
<p>The details for hardware capabilities discovered on the host. These are
filled in by the provisioning agent when the host is registered.</p>
</div>
<div class="paragraph">
<p>The sub-fields are</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>nics</em>&#8201;&#8212;&#8201;List of network interfaces for the host.</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>&#8201;&#8212;&#8201;A string identifying the network device, e.g. <em>nic-1</em>.</p>
</li>
<li>
<p><em>mac</em>&#8201;&#8212;&#8201;The MAC address of the NIC.</p>
</li>
<li>
<p><em>ip</em>&#8201;&#8212;&#8201;The IP address of the NIC, if one was assigned when the
discovery agent ran.</p>
</li>
<li>
<p><em>speedGbps</em>&#8201;&#8212;&#8201;The speed of the device in Gbps.</p>
</li>
<li>
<p><em>vlans</em>&#8201;&#8212;&#8201;A list holding all the VLANs available for this NIC.</p>
</li>
<li>
<p><em>vlanId</em>&#8201;&#8212;&#8201;The untagged VLAN ID.</p>
</li>
<li>
<p><em>pxe</em>&#8201;&#8212;&#8201;Whether the NIC is able to boot using PXE.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>storage</em>&#8201;&#8212;&#8201;List of storage (disk, SSD, etc.) available to the host.</p>
<div class="ulist">
<ul>
<li>
<p><em>name</em>&#8201;&#8212;&#8201;A string identifying the storage device, e.g. <em>disk 1
(boot)</em>.</p>
</li>
<li>
<p><em>rotational</em>&#8201;&#8212;&#8201;Either true or false, indicates whether the disk is
rotational.</p>
</li>
<li>
<p><em>sizeBytes</em>&#8201;&#8212;&#8201;Size of the storage device.</p>
</li>
<li>
<p><em>serialNumber</em>&#8201;&#8212;&#8201;The device&#8217;s serial number.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>cpu</em>&#8201;&#8212;&#8201;Details of the CPU(s) in the system.</p>
<div class="ulist">
<ul>
<li>
<p><em>arch</em>&#8201;&#8212;&#8201;The architecture of the CPU.</p>
</li>
<li>
<p><em>model</em>&#8201;&#8212;&#8201;The model string.</p>
</li>
<li>
<p><em>clockMegahertz</em>&#8201;&#8212;&#8201;The speed in GHz of the CPU.</p>
</li>
<li>
<p><em>flags</em>&#8201;&#8212;&#8201;List of CPU flags, e.g. 'mmx','sse','sse2','vmx', &#8230;&#8203;</p>
</li>
<li>
<p><em>count</em>&#8201;&#8212;&#8201;Amount of these CPUs available in the system.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>firmware</em>&#8201;&#8212;&#8201;Contains BIOS information like for instance its <em>vendor</em>
and <em>version</em>.</p>
</li>
<li>
<p><em>systemVendor</em>&#8201;&#8212;&#8201;Contains information about the host&#8217;s
<em>manufacturer</em>, the <em>productName</em> and <em>serialNumber</em>.</p>
</li>
<li>
<p><em>ramMebibytes</em>&#8201;&#8212;&#8201;The host&#8217;s amount of memory in Mebibytes.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_hardwareprofile_status">hardwareProfile (status)</h5>
<div class="paragraph">
<p><strong>This field is deprecated. See rootDeviceHints instead.</strong></p>
</div>
<div class="paragraph">
<p>The name of the hardware profile that matches the hardware discovered on
the host based on the details saved to the <em>Hardware</em> section. If the
hardware does not match any known profile, the value <code>unknown</code> will be
set on this field and is used by default. In practice, this only affects
which device the OS image will be written to. The following are the
current supported <code>hardwareProfile</code> settings and their corresponding
root devices.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;"/>
<col style="width: 50%;"/>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top"><strong>hardwareProfile</strong></th>
<th class="tableblock halign-left valign-top"><strong>Root Device</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>unknown</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/dev/sda</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>libvirt</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/dev/vda</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dell</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HCTL: 0:0:0:0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>dell-raid</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">HCTL: 0:2:0:0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>openstack</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/dev/vdb</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>NOTE:</strong> These are subject to change.</p>
</div>
</div>
<div class="sect4">
<h5 id="_poweredon">poweredOn</h5>
<div class="paragraph">
<p>Boolean indicating whether the host is powered on.</p>
</div>
<div class="paragraph">
<p>See <em>online</em> on the <em>BareMetalHost&#8217;s</em> <em>Spec</em>.</p>
</div>
</div>
<div class="sect4">
<h5 id="_provisioning">provisioning</h5>
<div class="paragraph">
<p>Settings related to deploying an image to the host.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><em>state</em>&#8201;&#8212;&#8201;The current state of any ongoing provisioning operation.
The following are the currently supported ones:</p>
<div class="ulist">
<ul>
<li>
<p><em>&lt;empty string&gt;</em>&#8201;&#8212;&#8201;There is no provisioning happening, at the
moment.</p>
</li>
<li>
<p><em>registration error</em>&#8201;&#8212;&#8201;The details for the host&#8217;s BMC are either
incorrect or incomplete therfore the host could not be managed.</p>
</li>
<li>
<p><em>registering</em>&#8201;&#8212;&#8201;The host&#8217;s BMC details are being checked.</p>
</li>
<li>
<p><em>match profile</em>&#8201;&#8212;&#8201;The discovered hardware details on the host are
being compared against known profiles.</p>
</li>
<li>
<p><em>ready</em>&#8201;&#8212;&#8201;The host is available to be consumed.</p>
</li>
<li>
<p><em>provisioning</em>&#8201;&#8212;&#8201;An image is being written to the host&#8217;s disk(s).</p>
</li>
<li>
<p><em>provisioning error</em>&#8201;&#8212;&#8201;The image could not be written to the host.</p>
</li>
<li>
<p><em>provisioned</em>&#8201;&#8212;&#8201;An image has been completely written to the host&#8217;s
disk(s).</p>
</li>
<li>
<p><em>externally provisioned</em>&#8201;&#8212;&#8201;MetalÂ³ does not manage the image on the
host.</p>
</li>
<li>
<p><em>deprovisioning</em>&#8201;&#8212;&#8201;The image is being wiped from the host&#8217;s disk(s).</p>
</li>
<li>
<p><em>inspecting</em>&#8201;&#8212;&#8201;The hardware details for the host are being collected
by an agent.</p>
</li>
<li>
<p><em>power management error</em>&#8201;&#8212;&#8201;An error was found while trying to power
the host either on or off.</p>
</li>
</ul>
</div>
</li>
<li>
<p><em>id</em>&#8201;&#8212;&#8201;The unique identifier for the service in the underlying
provisioning tool.</p>
</li>
<li>
<p><em>image</em>&#8201;&#8212;&#8201;The image most recently provisioned to the host.</p>
</li>
<li>
<p><em>rootDeviceHints</em>&#8201;&#8212;&#8201;The root device selection instructions used for
the most recent provisioning operation.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_baremetalhost_example">1.1.3. BareMetalHost Example</h4>
<div class="paragraph">
<p>The following is a complete example from a running cluster of a
<em>BareMetalHost</em> resource (in YAML), it includes its specification and
status sections:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  creationTimestamp: "2019-09-20T06:33:35Z"
  finalizers:
  - baremetalhost.metal3.io
  generation: 2
  name: bmo-master-0
  namespace: bmo-project
  resourceVersion: "22642"
  selfLink: /apis/metal3.io/v1alpha1/namespaces/bmo-project/baremetalhosts/bmo-master-0
  uid: 92b2f77a-db70-11e9-9db1-525400764849
spec:
  bmc:
    address: ipmi://10.10.57.19
    credentialsName: bmo-master-0-bmc-secret
  bootMACAddress: 98:03:9b:61:80:48
  consumerRef:
    apiVersion: machine.openshift.io/v1beta1
    kind: Machine
    name: bmo-master-0
    namespace: bmo-project
  externallyProvisioned: true
  hardwareProfile: default
  image:
    checksum: http://172.16.1.100/images/myOSv1/myOS.qcow2.md5sum
    url: http://172.16.1.100/images/myOSv1/myOS.qcow2
  online: true
  userData:
    name: bmo-master-user-data
    namespace: bmo-project
  networkData:
    name: bmo-master-network-data
    namespace: bmo-project
  metaData:
    name: bmo-master-meta-data
    namespace: bmo-project
status:
  errorMessage: ""
  goodCredentials:
    credentials:
      name: bmo-master-0-bmc-secret
      namespace: bmo-project
    credentialsVersion: "5562"
  hardware:
    cpu:
      arch: x86_64
      clockMegahertz: 2000
      count: 40
      flags: []
      model: Intel(R) Xeon(R) Gold 6138 CPU @ 2.00GHz
    firmware:
      bios:
        date: 12/17/2018
        vendor: Dell Inc.
        version: 1.6.13
    hostname: bmo-master-0.localdomain
    nics:
    - ip: 172.22.135.105
      mac: "00:00:00:00:00:00"
      model: unknown
      name: eno1
      pxe: true
      speedGbps: 25
      vlanId: 0
    ramMebibytes: 0
    storage: []
    systemVendor:
      manufacturer: Dell Inc.
      productName: PowerEdge r460
      serialNumber: ""
  hardwareProfile: ""
  lastUpdated: "2019-09-20T07:03:23Z"
  operationalStatus: OK
  poweredOn: true
  provisioning:
    ID: a4438010-3fc6-4c5c-b570-900bbe85da57
    image:
      checksum: ""
      url: ""
    state: externally provisioned
  triedCredentials:
    credentials:
      name: bmo-master-0-bmc-secret
      namespace: bmo-project
    credentialsVersion: "5562"</code></pre>
</div>
</div>
<div class="paragraph">
<p>And here is the secret <code>bmo-master-0-bmc-secret</code> holding the host&#8217;s BMC
credentials, base64 encoded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">$echo -n 'admin' | base64
YWRtaW4=

$echo -n 'password' | base64
cGFzc3dvcmQ=</code></pre>
</div>
</div>
<div class="paragraph">
<p>Copy the above base64 encoded username and password pair and paste it
into the yaml as mentioned below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">---
apiVersion: v1
kind: Secret
metadata:
  name: bmo-master-0-bmc-secret
type: Opaque
data:
  username: YWRtaW4=
  password: cGFzc3dvcmQ=</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_triggering_provisioning">1.2. Triggering Provisioning</h3>
<div class="paragraph">
<p>Several conditions must be met in order to initiate provisioning.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The host <code>spec.image.url</code> field must contain a URL for a valid image
file that is visible from within the cluster and from the host receiving
the image.</p>
</li>
<li>
<p>The host must have <code>online</code> set to <code>true</code> so that the operator will
keep the host powered on.</p>
</li>
<li>
<p>The host must have all of the BMC details.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>To initiate deprovisioning, clear the image URL from the host spec.</p>
</div>
</div>
<div class="sect2">
<h3 id="_unmanaged_hosts">1.3. Unmanaged Hosts</h3>
<div class="paragraph">
<p>Hosts created without BMC details will be left in the <code>unmanaged</code> state
until the details are provided. Unmanaged hosts cannot be provisioned
and their power state is undefined.</p>
</div>
</div>
<div class="sect2">
<h3 id="_pausing_reconciliation">1.4. Pausing reconciliation</h3>
<div class="paragraph">
<p>It is possible to pause the reconciliation of a BareMetalHost object by
adding an annotation <code>baremetalhost.metal3.io/paused</code>. MetalÂ³ provider
sets the value of this annotation as <code>metal3.io/capm3</code> when the cluster
to which the BareMetalHost belongs, is paused and removes it when the
cluster is not paused. If you want to pause the reconciliation of
BareMetalHost you can put any value on this annotation other than
<code>metal3.io/capm3</code>. Please make sure that you remove the annotation
only if the value of the annotation is not <code>metal3.io/capm3</code>, but
another value that you have provided*. Removing the annotation will
enable the reconciliation again.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_setup_development_environment">2. Setup Development Environment</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_with_minikube">2.1. With minikube</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Install and launch <a href="https://kubernetes.io/docs/setup/minikube/">minikube</a></p>
</li>
<li>
<p>Create a namespace to host the operator</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl create namespace metal3</code></pre>
</div>
</div>
</li>
<li>
<p>Install operator in the cluster</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">eval $(go env)
mkdir -p $GOPATH/src/github.com/metal3-io
cd $GOPATH/src/github.com/metal3-io
git clone https://github.com/metal3-io/baremetal-operator.git
cd baremetal-operator
kustomize build config/default | kubectl apply -f</code></pre>
</div>
</div>
</li>
<li>
<p>Or Launch the operator locally</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export OPERATOR_NAME=baremetal-operator
export DEPLOY_KERNEL_URL=http://172.22.0.1/images/ironic-python-agent.kernel
export DEPLOY_RAMDISK_URL=http://172.22.0.1/images/ironic-python-agent.initramfs
export IRONIC_ENDPOINT=http://localhost:6385/v1/
export IRONIC_INSPECTOR_ENDPOINT=http://localhost:5050/v1
make run</code></pre>
</div>
</div>
</li>
<li>
<p>Create the CR</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">kubectl apply -f examples/example-host.yaml -n metal3</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_running_without_ironic">2.2. Running without Ironic</h3>
<div class="paragraph">
<p>In environments where Ironic is not available, and the only real need is
to be able to have some test data, use the test fixture provisioner
instead of the real Ironic provisioner by passing <code>-test-mode</code> to the
operator when launching it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">make run-test-mode</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_running_a_local_instance_of_ironic">2.3. Running a local instance of Ironic</h3>
<div class="paragraph">
<p>There is a script available that will run a set of containers locally
using <code>podman</code> to stand up Ironic for development and testing.</p>
</div>
<div class="paragraph">
<p>See <code>tools/run_local_ironic.sh</code>.</p>
</div>
<div class="paragraph">
<p>Note that this script may need customizations to some of the
<code>podman run</code> commands, to include environment variables that configure
the containers for your environment. All ironic related environment
variables are set by default if they are not passed through the
environment.</p>
</div>
<div class="paragraph">
<p>The following environment variables can be passed to configure the
ironic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>HTTP_PORT - port used by httpd server (default 6180)</p>
</li>
<li>
<p>PROVISIONING_IP - provisioning interface IP address to use for ironic,
dnsmasq(dhcpd) and httpd (default 172.22.0.1)</p>
</li>
<li>
<p>CLUSTER_PROVISIONING_IP - cluster provisioning interface IP address
(default 172.22.0.2)</p>
</li>
<li>
<p>PROVISIONING_CIDR - provisioning interface IP address CIDR (default
24)</p>
</li>
<li>
<p>PROVISIONING_INTERFACE - interface to use for ironic, dnsmasq(dhcpd)
and httpd (default ironicendpoint)</p>
</li>
<li>
<p>CLUSTER_DHCP_RANGE - dhcp range to use for provisioning (default
172.22.0.10-172.22.0.100)</p>
</li>
<li>
<p>DEPLOY_KERNEL_URL - the URL of the kernel to deploy
ironic-python-agent</p>
</li>
<li>
<p>DEPLOY_RAMDISK_URL - the URL of the ramdisk to deploy
ironic-python-agent</p>
</li>
<li>
<p>IRONIC_ENDPOINT - the endpoint of the ironic</p>
</li>
<li>
<p>IRONIC_INSPECTOR_ENDPOINT - the endpoint of the ironic inspector</p>
</li>
<li>
<p>CACHEURL - the URL of the cached images</p>
</li>
<li>
<p>IRONIC_FAST_TRACK - whether to enable fast_track provisioning or not
(default true)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_using_tilt_for_development">2.4. Using Tilt for development</h3>
<div class="paragraph">
<p>It is easy to use Tilt for BMO deployment. Once you have a local
instance of Ironic running, just run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">  make tilt-up</code></pre>
</div>
</div>
<div class="paragraph">
<p>and clean it with</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">  make kind-reset</code></pre>
</div>
</div>
<div class="paragraph">
<p>It is also possible to develop Baremetal Operator using Tilt with CAPM3.
Please refer to
<a href="https://github.com/metal3-io/cluster-api-provider-metal3/blob/master/docs/dev-setup.md#tilt-for-dev-in-capm3">the
development setup guide of CAPM3</a> and specially the
<a href="https://github.com/metal3-io/cluster-api-provider-metal3/blob/master/docs/dev-setup.md#including-baremetal-operator-and-ip-address-manager">Baremetal
Operator Integration</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_using_libvirt_vms_with_ironic">2.5. Using libvirt VMs with Ironic</h3>
<div class="paragraph">
<p>In order to use VMs as hosts, they need to be connected to
<a href="https://docs.openstack.org/project-deploy-guide/tripleo-docs/latest/environments/virtualbmc.html">vbmc</a>
and the <code>bootMACAddress</code> field needs to be set to the MAC address of the
network interface that will PXE boot.</p>
</div>
<div class="paragraph">
<p>For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: worker-0
spec:
  online: true
  bmc:
    address: libvirt://192.168.122.1:6233/
    credentialsName: worker-0-bmc-secret
  bootMACAddress: 00:73:49:3a:76:8e</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>make-virt-host</code> utility can be used to generate a YAML file for
registering a host. It takes as input the name of the <code>virsh</code> domain and
produces as output the basic YAML to register that host properly, with
the boot MAC address and BMC address filled in.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ go run cmd/make-virt-host/main.go openshift_worker_1
---
apiVersion: v1
kind: Secret
metadata:
  name: openshift-worker-1-bmc-secret
type: Opaque
data:
  username: YWRtaW4=
  password: cGFzc3dvcmQ=

---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: openshift-worker-1
spec:
  online: true
  bmc:
    address: libvirt://192.168.122.1:6234/
    credentialsName: openshift-worker-1-bmc-secret
  bootMACAddress: 00:1a:74:74:e5:cf</code></pre>
</div>
</div>
<div class="paragraph">
<p>The output can be passed directly to <code>kubectl apply</code> like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">go run cmd/make-virt-host/main.go openshift_worker_1 | kubectl apply -f -</code></pre>
</div>
</div>
<div class="paragraph">
<p>When the host is a <em>master</em>, include the <code>-consumer</code> and
<code>-consumer-namespace</code> options to associate the host with the existing
<code>Machine</code> object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ go run cmd/make-virt-host/main.go -consumer ostest-master-1 \
  -consumer-namespace openshift-machine-api  openshift_master_1
---
apiVersion: v1
kind: Secret
metadata:
  name: openshift-master-1-bmc-secret
type: Opaque
data:
  username: YWRtaW4=
  password: cGFzc3dvcmQ=

---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: openshift-master-1
spec:
  online: true
  bmc:
    address: libvirt://192.168.122.1:6231/
    credentialsName: openshift-master-1-bmc-secret
  bootMACAddress: 00:c9:a0:f2:e0:59
  consumerRef:
    name: ostest-master-1
    namespace: openshift-machine-api</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_bare_metal_hosts">2.6. Using Bare Metal Hosts</h3>
<div class="paragraph">
<p>The <code>make-bm-worker</code> tool may be a more convenient way of creating YAML
definitions for workers than editing the files directly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ go run cmd/make-bm-worker/main.go -address 1.2.3.4 \
  -password password -user admin worker-99</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml">apiVersion: v1
kind: Secret
metadata:
  name: worker-99-bmc-secret
type: Opaque
data:
  username: YWRtaW4=
  password: cGFzc3dvcmQ=

---
apiVersion: metal3.io/v1alpha1
kind: BareMetalHost
metadata:
  name: worker-99
spec:
  online: true
  bmc:
    address: 1.2.3.4
    credentialsName: worker-99-bmc-secret
    disableCertificateVerification: true</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_the_tests">3. Running the tests</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_setup">3.1. Setup</h3>
<div class="paragraph">
<p>The user running the tests must have permission on the cluster to create
CRDs. An example role binding setting for configuring the "developer"
user is provided in test/e2e/role_binding.yaml</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">oc --as system:admin apply -f test/e2e/role_binding.yaml</code></pre>
</div>
</div>
<div class="sect3">
<h4 id="_run_the_unit_tests">3.1.1. Run the unit tests</h4>
<div class="paragraph">
<p>The tests can be run via <code>make</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">make test</code></pre>
</div>
</div>
<div class="paragraph">
<p>Run linters test before pushing your commit</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">make lint</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_using_the_hack_scripts">3.2. Using the Hack scripts</h3>
<div class="paragraph">
<p>The repository contains a <code>hack</code> directory which has some very useful
scripts for setting up containerized testing environments. It also has
Dockerfiles to allow you to generate images for your own use.</p>
</div>
<div class="paragraph">
<p>All the scripts accept the <code>CONTAINER_RUNTIME</code> environment variable with
default of <code>podman</code>. This you can edit to <code>docker</code> as well.</p>
</div>
<div class="sect3">
<h4 id="_example_of_running_golint_in_a_docker_container">3.2.1. Example of running <code>golint</code> in a Docker container</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Start by setting the environment variable appropriately</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">export CONTAINER_RUNTIME=docker</code></pre>
</div>
</div>
</li>
<li>
<p>From the operator parent dir, you can invoke the hack scripts</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">./hack/golint.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>Note</strong> It&#8217;s important to be in the operator parent dir because it
contains the <code>Makefile</code> that is used in running the tests for the
operator. Otherwise, you&#8217;ll see the following error</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">sh: 0: Can't open /go/src/github.com/metal3-io/baremetal-operator/hack/golint.sh</code></pre>
</div>
</div>
</li>
<li>
<p>Upon successful execution, you should see the following output. I
already had all the images available from a previous run, you might see
the images getting downloaded if you&#8217;re running for the very first time.</p>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">+ IS_CONTAINER=false
+ CONTAINER_RUNTIME=docker
+ [ false != false ]
+ docker run --rm --env IS_CONTAINER=TRUE --volume /home/noor/go/src/github.com/metal3-io/baremetal-operator:/go/src/github.com/metal3-io/baremetal-operator:ro,z\
--entrypoint sh --workdir /go/src/github.com/metal3-io/baremetal-operator\
quay.io/metal3-io/golint:latest /go/src/github.com/metal3-io/baremetal-operator/hack/golint.sh
+ IS_CONTAINER=TRUE
+ CONTAINER_RUNTIME=podman
+ [ TRUE != false ]
+ export XDG_CACHE_HOME=/tmp/.cache
+ make lint
which golint 2&gt;&amp;1 &gt;/dev/null || make OPATH/bin/golint
find ./pkg ./cmd -type f -name \*.go  |grep -v zz_ | xargs -L1 golint -set_exit_status</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_getting_the_latest_tooling">3.3. Getting the latest tooling</h3>
<div class="paragraph">
<p>For testing without the hack scripts, make sure you install the latest
development tools using <code>go get</code>, e-g</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># go get golang.org/x/lint/golint</code></pre>
</div>
</div>
<div class="paragraph">
<p>This ensures that the linters you have locally and the ones running in
the CI are matched and helps avoid inconsistencies. Happy coding!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_running_baremetal_operator_with_or_without_ironic">4. Running Baremetal Operator with or without Ironic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This document explains the deployment scenarios of deploying Bare Metal
Operator(BMO) with or without Ironic as well as deploying only Ironic
scenario.</p>
</div>
<div class="paragraph">
<p><strong>These are the deployment use cases in this document:</strong></p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Deploying baremetal-operator with Ironic.</p>
</li>
<li>
<p>Deploying baremetal-operator without Ironic.</p>
</li>
<li>
<p>Deploying only Ironic.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_current_structure_of_baremetal_operator_config_directory">4.1. Current structure of baremetal-operator config directory</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-diff" data-lang="diff">tree config/
config/
âââ basic-auth
âÂ Â  âââ default
âÂ Â  âÂ Â  âââ credentials.yaml
âÂ Â  âÂ Â  âââ kustomization.yaml
âÂ Â  âââ tls
âÂ Â      âââ credentials.yaml
âÂ Â      âââ kustomization.yaml
âââ certmanager
âÂ Â  âââ certificate.yaml
âÂ Â  âââ kustomization.yaml
âÂ Â  âââ kustomizeconfig.yaml
âââ crd
âÂ Â  âââ bases
âÂ Â  âÂ Â  âââ metal3.io_baremetalhosts.yaml
âÂ Â  âââ kustomization.yaml
âÂ Â  âââ kustomizeconfig.yaml
âÂ Â  âââ patches
âÂ Â      âââ cainjection_in_baremetalhosts.yaml
âÂ Â      âââ webhook_in_baremetalhosts.yaml
âââ default
âÂ Â  âââ ironic.env
âÂ Â  âââ kustomization.yaml
âÂ Â  âââ manager_auth_proxy_patch.yaml
âÂ Â  âââ manager_webhook_patch.yaml
âÂ Â  âââ webhookcainjection_patch.yaml
âââ kustomization.yaml
âââ manager
âÂ Â  âââ kustomization.yaml
âÂ Â  âââ manager.yaml
âââ namespace
âÂ Â  âââ kustomization.yaml
âÂ Â  âââ namespace.yaml
âââ prometheus
âÂ Â  âââ kustomization.yaml
âÂ Â  âââ monitor.yaml
âââ rbac
âÂ Â  âââ auth_proxy_client_clusterrole.yaml
âÂ Â  âââ auth_proxy_role_binding.yaml
âÂ Â  âââ auth_proxy_role.yaml
âÂ Â  âââ auth_proxy_service.yaml
âÂ Â  âââ baremetalhost_editor_role.yaml
âÂ Â  âââ baremetalhost_viewer_role.yaml
âÂ Â  âââ kustomization.yaml
âÂ Â  âââ leader_election_role_binding.yaml
âÂ Â  âââ leader_election_role.yaml
âÂ Â  âââ role_binding.yaml
âÂ Â  âââ role.yaml
âââ render
âÂ Â  âââ capm3.yaml
âââ samples
âÂ Â  âââ metal3.io_v1alpha1_baremetalhost.yaml
âââ tls
âÂ Â  âââ kustomization.yaml
âÂ Â  âââ tls_ca.yaml
âââ webhook
    âââ kustomization.yaml
    âââ kustomizeconfig.yaml
    âââ service.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>config</code> directory has one top level folder for deployment, namely
<code>default</code> and it deploys only baremetal-operator through kustomization
file calling <code>manager</code> folder. In addition, <code>basic-auth</code>, <code>certmanager</code>,
<code>crd</code>, <code>namespace</code>, <code>prometheus</code>, <code>rbac</code>, <code>tls</code> and `webhook`folders
have their own kustomization and yaml files.</p>
</div>
</div>
<div class="sect2">
<h3 id="_current_structure_of_ironic_deployment_directory">4.2. Current structure of ironic-deployment directory</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-diff" data-lang="diff">tree ironic-deployment/
ironic-deployment/
âââ basic-auth
âÂ Â  âââ default
âÂ Â  âÂ Â  âââ auth.yaml
âÂ Â  âÂ Â  âââ kustomization.yaml
âÂ Â  âââ ironic-auth-config-tpl
âÂ Â  âââ ironic-inspector-auth-config-tpl
âÂ Â  âââ ironic-rpc-auth-config-tpl
âÂ Â  âââ keepalived
âÂ Â  âÂ Â  âââ auth.yaml
âÂ Â  âÂ Â  âââ kustomization.yaml
âÂ Â  âââ tls
âÂ Â      âââ default
âÂ Â      âÂ Â  âââ auth.yaml
âÂ Â      âÂ Â  âââ kustomization.yaml
âÂ Â      âââ keepalived
âÂ Â          âââ auth.yaml
âÂ Â          âââ kustomization.yaml
âââ default
âÂ Â  âââ ironic_bmo_configmap.env
âÂ Â  âââ kustomization.yaml
âââ ironic
âÂ Â  âââ ironic.yaml
âÂ Â  âââ kustomization.yaml
âââ keepalived
âÂ Â  âââ ironic_bmo_configmap.env
âÂ Â  âââ keepalived_patch.yaml
âÂ Â  âââ kustomization.yaml
âââ tls
    âââ default
    âÂ Â  âââ kustomization.yaml
    âÂ Â  âââ tls.yaml
    âââ keepalived
        âââ kustomization.yaml
        âââ tls.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Ironic-deployment folder has three top level folder for deployments,
namely <code>default</code>, <code>ironic</code> and <code>keepalived</code>. <code>default</code> and <code>ironic</code>
deploy only ironic, <code>keepalived</code> deploys the ironic with keepalived. As
the name implies, <code>keepalived/keepalived_patch.yaml</code> patches the default
image URL through kustomization. <code>tls</code> and <code>basic-auth</code> folders contain
deployment files to add TLS and Basic Auth support between
baremetal-operator and ironic.</p>
</div>
</div>
<div class="sect2">
<h3 id="_deployment_commands">4.3. Deployment commands</h3>
<div class="paragraph">
<p>There is a useful deployment script that configures and deploys
BareMetal Operator and Ironic. It requires some variables :</p>
</div>
<div class="ulist">
<ul>
<li>
<p>IRONIC_HOST : domain name for Ironic and inspector</p>
</li>
<li>
<p>IRONIC_HOST_IP : IP on which Ironic and inspector are listening</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition you can configure the following variables. They are
<strong>optional</strong>. If you leave them unset, then passwords and certificates
will be generated for you.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>KUBECTL_ARGS : Additional arguments to kubectl apply</p>
</li>
<li>
<p>IRONIC_USERNAME : username for ironic</p>
</li>
<li>
<p>IRONIC_PASSWORD : password for ironic</p>
</li>
<li>
<p>IRONIC_INSPECTOR_USERNAME : username for inspector</p>
</li>
<li>
<p>IRONIC_INSPECTOR_PASSWORD : password for inspector</p>
</li>
<li>
<p>IRONIC_CACERT_FILE : CA certificate path for ironic</p>
</li>
<li>
<p>IRONIC_CAKEY_FILE : CA certificate key path, unneeded if ironic
certificates exist</p>
</li>
<li>
<p>IRONIC_CERT_FILE : Ironic certificate path</p>
</li>
<li>
<p>IRONIC_KEY_FILE : Ironic certificate key path</p>
</li>
<li>
<p>IRONIC_INSPECTOR_CERT_FILE : Inspector certificate path</p>
</li>
<li>
<p>IRONIC_INSPECTOR_KEY_FILE : Inspector certificate key path</p>
</li>
<li>
<p>IRONIC_INSPECTOR_CACERT_FILE : CA certificate path for inspector,
defaults to IRONIC_CACERT_FILE</p>
</li>
<li>
<p>IRONIC_INSPECTOR_CAKEY_FILE : CA certificate key path, unneeded if
inspector certificates exist</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Then run :</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-sh" data-lang="sh">./tools/deploy.sh &lt;deploy-BMO&gt; &lt;deploy-Ironic&gt; &lt;deploy-TLS&gt; &lt;deploy-Basic-Auth&gt; &lt;deploy-Keepalived&gt;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p><code>deploy-BMO</code> : deploy BareMetal Operator : "true" or "false"</p>
</li>
<li>
<p><code>deploy-Ironic</code> : deploy Ironic : "true" or "false"</p>
</li>
<li>
<p><code>deploy-TLS</code> : deploy with TLS enabled : "true" or "false"</p>
</li>
<li>
<p><code>deploy-Basic-Auth</code> : deploy with Basic Auth enabled : "true" or
"false"</p>
</li>
<li>
<p><code>deploy-Keepalived</code> : deploy with Keepalived for ironic : "true" or
"false"</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This will deploy BMO and / or Ironic with the proper configuration.</p>
</div>
</div>
<div class="sect2">
<h3 id="_useful_tips">4.4. Useful tips</h3>
<div class="paragraph">
<p>It is worth mentioning some tips for when the different configurations
are useful as well. For example:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Only BMO is deployed, in a case when Ironic is already running, e.g.
as part of Cluster API Provider Metal3
<a href="https://github.com/metal3-io/cluster-api-provider-metal3">(CAPM3)</a> when a
successful pivoting state was met and ironic being deployed.</p>
</li>
<li>
<p>BMO and Ironic are deployed together, in a case when CAPM3 is not used
and baremetal-operator and ironic containers to be deployed together.</p>
</li>
<li>
<p>Only Ironic is deployed, in a case when BMO is deployed as part of
CAPM3 and only Ironic setup is sufficient, e.g.
<a href="https://cluster-api.sigs.k8s.io/clusterctl/commands/move.html">clusterctl</a>
provided by Cluster API(CAPI) deploys BMO, so that it can take care of
moving the BaremetalHost during the pivoting.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>Important Note</strong> When the baremetal-operator is deployed through
metal3-dev-env, baremetal-operator container inherits the following
environment variables through configmap:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-ini" data-lang="ini">$PROVISIONING_IP
$PROVISIONING_CIDR
$PROVISIONING_INTERFACE</code></pre>
</div>
</div>
<div class="paragraph">
<p>In case you are deploying baremetal-operator locally, make sure to
populate and export these environment variables before deploying.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_authenticating_to_ironic">5. Authenticating to Ironic</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Because hosts under the control of MetalÂ³ need to contact the Ironic and
Ironic Inspector APIs during inspection and provisioning, it is highly
advisable to require authentication on those APIs, since the provisioned
hosts running user workloads will remain connected to the provisioning
network.</p>
</div>
<div class="sect2">
<h3 id="_configuration">5.1. Configuration</h3>
<div class="paragraph">
<p>The <code>baremetal-operator</code> supports connecting to Ironic and Ironic
Inspector configured with the following <code>auth_strategy</code> modes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>noauth</code> (no authentication)</p>
</li>
<li>
<p><code>http_basic</code> (HTTP
<a href="https://en.wikipedia.org/wiki/Basic_access_authentication">Basic access
authentication</a>)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Note that Keystone authentication methods are not yet supported.</p>
</div>
<div class="paragraph">
<p>Authentication configuration is read from the filesystem, beginning at
the root directory specified in the environment variable
<code>METAL3_AUTH_ROOT_DIR</code>. If this variable is empty or not specified, the
default is <code>/opt/metal3/auth</code>.</p>
</div>
<div class="paragraph">
<p>Within the root directory there are separate subdirectories, <code>ironic</code>
for Ironic client configuration, and <code>ironic-inspector</code> for Ironic
Inspector client configuration. (This allows the data to be populated
from separate secrets when deploying in Kubernetes.)</p>
</div>
<div class="sect3">
<h4 id="_noauth">5.1.1. <code>noauth</code></h4>
<div class="paragraph">
<p>This is the default, and will be chosen if the auth root directory does
not exist. In this mode, the baremetal-operator does not attempt to do
any authentication against the Ironic APIs.</p>
</div>
</div>
<div class="sect3">
<h4 id="_http_basic">5.1.2. <code>http_basic</code></h4>
<div class="paragraph">
<p>This mode is configured by files in each authentication subdirectory
named <code>username</code> and <code>password</code>, and containing the Basic auth username
and password, respectively.</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-10-25 01:47:33 +0300
</div>
</div>
</body>
</html>